{"key":"content:3.docs:3.deployment:99.presets:node.md","generatedAt":"2021-10-13T13:08:13.167Z","mtime":"2021-10-13T13:08:13.162Z","slug":"node","title":"Node.js function","position":"000300030099","to":"/docs/deployment/presets/node","draft":false,"page":true,"language":"en","empty":false,"description":"Discover the Node.js function preset with Nitro to attach Nuxt as a middleware to any Node.js server.","body":{"raw":"# Node.js function\n\nDiscover the Node.js function preset with Nitro to attach Nuxt as a middleware to any Node.js server.\n\n::list\n- Compatible with many Node.js servers\n- Drop-in usage with express or native http server\n- Loads only the chunks required to render the request for optimal cold start timing\n::\n\n::alert{icon=IconPresets}\nBack to [presets list](/docs/deployment/presets).\n::\n\n## Usage\n\nYou can use the [Nuxt config](/docs/directory-structure/nuxt.config) to explicity set the preset to use:\n\n```ts [nuxt.config.js|ts]\nexport default {\n  nitro: {\n    preset: 'node'\n  }\n}\n```\n\nOr directly use the `NITRO_PRESET` environment variable when running `nuxt build`:\n\n```bash\nNITRO_PRESET=node npx nuxt build\n```\n\n## Entrypoint\n\nWhen running `nuxt build` with the Node preset, the result will be an entrypoint exporting a function with the familiar `(req, res) => {}` signature used in [express](https://expressjs.com/), [h3](https://github.com/unjs/h3), etc.\n\n::alert{type=warning}\nIt is not recommended to use this preset directly, and particularly not with a 3rd-party server.\n::\n\n## Example\n\n### Express middleware\n\n```ts\nimport express from 'express'\nimport handler from './.output/server'\n\nconst app = express()\n\napp.use(handler)\napp.listen(3000)\n```\n\n### Node server\n\n```ts\nimport { createServer } from 'http'\nimport handler from './.output/server'\n\nconst server = createServer(handler)\nserver.listen(8080)\n```\n\n","ast":{"type":"root","children":[{"type":"element","tag":"prose-h1","props":{"class":"d-heading-title","id":"nodejs-function"},"children":[{"type":"text","value":"Node.js function"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{"class":"d-heading-description"},"children":[{"type":"text","value":"Discover the Node.js function preset with Nitro to attach Nuxt as a middleware to any Node.js server."}]},{"type":"text","value":"\n"},{"type":"element","tag":"list","props":{},"children":[{"type":"element","tag":"prose-ul","props":{},"children":[{"type":"text","value":"\n"},{"type":"element","tag":"prose-li","props":{},"children":[{"type":"text","value":"\n"},{"type":"text","value":"Compatible with many Node.js servers"},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-li","props":{},"children":[{"type":"text","value":"\n"},{"type":"text","value":"Drop-in usage with express or native http server"},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-li","props":{},"children":[{"type":"text","value":"\n"},{"type":"text","value":"Loads only the chunks required to render the request for optimal cold start timing"},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"icon":"IconPresets"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Back to "},{"type":"element","tag":"prose-a","props":{"href":"/docs/deployment/presets"},"children":[{"type":"text","value":"presets list"}]},{"type":"text","value":"."}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"usage"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#usage"},"children":[{"type":"text","value":"Usage"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"You can use the "},{"type":"element","tag":"prose-a","props":{"href":"/docs/directory-structure/nuxt.config"},"children":[{"type":"text","value":"Nuxt config"}]},{"type":"text","value":" to explicity set the preset to use:"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"nuxt.config.js|ts"}]},{"type":"element","tag":"pre","props":{"className":["line-numbers","language-ts"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"default"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n  nitro"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":"\n    preset"},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'node'"}]},{"type":"text","value":"\n  "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"Or directly use the "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"NITRO_PRESET"}]},{"type":"text","value":" environment variable when running "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxt build"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-bash"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"NITRO_PRESET"}]},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"node npx nuxt build\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"entrypoint"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#entrypoint"},"children":[{"type":"text","value":"Entrypoint"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"When running "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"nuxt build"}]},{"type":"text","value":" with the Node preset, the result will be an entrypoint exporting a function with the familiar "},{"type":"element","tag":"prose-code-inline","props":{},"children":[{"type":"text","value":"(req, res) => {}"}]},{"type":"text","value":" signature used in "},{"type":"element","tag":"prose-a","props":{"href":"https://expressjs.com/","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"express"}]},{"type":"text","value":", "},{"type":"element","tag":"prose-a","props":{"href":"https://github.com/unjs/h3","rel":["nofollow","noopener","noreferrer"],"target":"_blank"},"children":[{"type":"text","value":"h3"}]},{"type":"text","value":", etc."}]},{"type":"text","value":"\n"},{"type":"element","tag":"alert","props":{"type":"warning"},"children":[{"type":"element","tag":"prose-paragraph","props":{},"children":[{"type":"text","value":"It is not recommended to use this preset directly, and particularly not with a 3rd-party server."}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h2","props":{"id":"example"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#example"},"children":[{"type":"text","value":"Example"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"express-middleware"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#express-middleware"},"children":[{"type":"text","value":"Express middleware"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-ts"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" express "},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'express'"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" handler "},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'./.output/server'"}]},{"type":"text","value":"\n\n"},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" app "},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"express"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n\napp"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"use"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"handler"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\napp"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-h3","props":{"id":"node-server"},"children":[{"type":"element","tag":"prose-a","props":{"href":"#node-server"},"children":[{"type":"text","value":"Node server"}]}]},{"type":"text","value":"\n"},{"type":"element","tag":"prose-code","props":{},"children":[{"type":"element","tag":"pre","props":{"className":["line-numbers","language-ts"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" createServer "},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'http'"}]},{"type":"text","value":"\n"},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" handler "},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"from"}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","string"]},"children":[{"type":"text","value":"'./.output/server'"}]},{"type":"text","value":"\n\n"},{"type":"element","tag":"span","props":{"className":["token","keyword"]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" server "},{"type":"element","tag":"span","props":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"createServer"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"handler"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\nserver"},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"className":["token","function"]},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"className":["token","number"]},"children":[{"type":"text","value":"8080"}]},{"type":"element","tag":"span","props":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"\n"}]}]}]}]},"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"usage","depth":2,"text":"Usage"},{"id":"entrypoint","depth":2,"text":"Entrypoint"},{"id":"example","depth":2,"text":"Example","children":[{"id":"express-middleware","depth":3,"text":"Express middleware"},{"id":"node-server","depth":3,"text":"Node server"}]}]}}}